# 03-Data Link

## 基本概念

### 定义

> 解决什么问题？

在有差错的线路上无差错传输

> ISO

建立、维护和释放网络实体间的数据链路

数据链路层协议定义了一条链路的两个结点间交换的数据单元格式，以及结点发送和接收数据单元的动作。

> 基本功能

- 链路管理
- 定界与同步
- **差错控制**
- **流量控制**
- 寻址

### 为网络层提供服务

> 三种合理服务

1. 无确认无连接服务

   误码率低，错误恢复留给高层

   大部分局域网

   实时业务

2. 有确认无连接

   无线网

3. 有确认有连接

## 错误检测和纠正

> 纠错码，检错码

**纠错可以纠错，检错只能检错**

### 奇偶校验

看的是原始数据中**1的个数**

在原始数据字节的最高位增加一个附加比特位，使结果中1的个数为奇数(奇校验)或偶数(偶校验)。增加的位称为奇偶校验位。

### 循环冗余校验

1. 规定一个多项式，把位串看成系数为0或1的多项式
2. (原始串+多项式位数-1个0)/多项式位串，把余数补在原始串后面，这样现在它可以整除多项式位串。（除法：相同为0不同为1）
3. 传过去之后，除多项式位串，有余数则有错

<img src="03-Data Link.assets/屏幕截图 2024-12-13 084613.png" alt="屏幕截图 2024-12-13 084613" style="zoom:50%;" />

## 数据链路层协议

### 理想条件

#### 完全理想化数据传输

理想信道+无穷缓存

1. 链路是理想的传输信道，所传送的任何数据既不会出差错也不会丢失
2. 不管发方以多快的速率发送数据，收方总是来得及收下，并及时上交主机：接收端向主机交付速率≥发送端发送速率

#### 简单流量控制

理想信道+有限缓存

由**收方控制发方**的数据流

<img src="03-Data Link.assets/屏幕截图 2024-12-13 084626.png" alt="屏幕截图 2024-12-13 084626" style="zoom:50%;" />

#### 使用的停-等协议

非理想信道+有限缓存

<img src="03-Data Link.assets/屏幕截图 2024-12-13 084637.png" alt="屏幕截图 2024-12-13 084637" style="zoom: 50%;" />

> 超时计时器

结点A发送完之后开始计时，设置重传时间tout，如果还是收不到B的确认帧就重传 具体的时间：发送到接受的平均值

> 解决重复帧

每个数据帧带上不同的发送序号，没发送一个新的就序号+1

B收到序号相同的数据帧的时候，就表明出现重复帧，但还是要发确认帧ACK

> 帧的编号问题

对于停止等待协议，由于每发送一个数据帧就停止等待，因此用1比特来编号就够了

数据帧中的发送序号 N(S) 以 0 和 1 交替的方式出现在数据帧中。

每发一个新的数据帧，发送序号就和上次发送的不一样。用这样的方法就可以使收方能够区分开新的数据帧和重传的数据帧了。

#### 停止等待协议的算法

ACKn：希望接收n号帧

> 发送节点流程

1. 取一个数据帧，给发送缓存
2. V(S)←0
3. N(S)←V(S)
4. 缓存发数据帧
5. 设计超时计数器
6. WAIT FOR 7OR8
7. 收到确认帧ACKn，若n=1-V(S)，表示成功接收，继续1，同时设置V(S)←[1-V(S)]
8. 超时，转到4

> 接收节点流程

1. V(R)←0
2. WAIT
3. 收到一个数据帧：若N(S)=V(R)，执行4，否则丢弃数据帧，执行6
4. 数据部分交给上层软件
5. V(R)←[1-V(R)]
6. n←V(R)，发送ACKn，转到2

**一些要点：**

- **接收端**接收到数据帧时，就要将发送序号 N(S)与本地的接收状态变量 V(R)相比较
- 出现相同发送序号的数据帧，表明发送端进行了超时重传
- 发送端在发送完数据帧时，必须在其发送缓存中暂时保留这个数据帧的副本，这样才能重传
- CRC检验器都是用硬件完成
- ARQ：Automatic Repeat reQuest自动重传请求

**定量分析**

<img src="03-Data Link.assets/image-20241213084718900.png" alt="image-20241213084718900" style="zoom:50%;" />

**优缺点**

优点：简单

缺点：信道利用率低

### 连续ARQ和选择重传ARQ

#### 连续ARQ协议

- 在发送完一个数据帧后，不是停下来等待确认帧，而是可以连续再发送若干个数据帧
- 如果这时收到了接收端发来的确认帧，那么还可以接着发送数据帧

<img src="03-Data Link.assets/image-20241213084804410.png" alt="image-20241213084804410" style="zoom:50%;" />

接收端**只按序接收数据帧**。虽然在有差错的 2号帧之后接着又收到了正确的 3 个数据帧，但接收端都必须将这些帧丢弃，因为在这些帧前面有一个 2 号帧还没有收到。虽然丢弃了这些不按序的无差错帧，但应重复发送已发送过的最后一个确认帧

结点 A 在每发送完一个数据帧时都要设置该帧的超时计时器：一人一个

### **滑动窗口协议**

发送端和接收端分别设定发送窗口和接收窗口，进行流量控制

发送窗口的大小 WT 代表在还没有收到对方确认信息的情况下发送端最多可以发送多少个数据帧

接收端只有当收到的数据帧的发送序号落入接收窗口内才允许将该数据帧收下，连续ARQ协议种，接收窗口WR=1

**特性**

- 接收窗口向前滑动，发送窗口才可能向前滑动
- 停止等待协议：WT=WR=1

**发送窗口最大值**

n个比特进行编号，接收窗口大小为1，发送窗口大小: $W_T\le 2^n-1$

#### 选择重传ARQ协议

可加大接收窗口，先收下发送序号不连续但仍处在接收窗口中的那些数据帧。等到所缺序号的数据帧收到后再一并送交主机

付出的代价是在接收端要设置具有相当容量的缓存空间

**接收窗口最大值**

$W_R\le 2^n/2$

### HDLC和PPP

high level data link control

面向比特协议

主站：发送命令帧，接收响应帧，管理链路

从站：接收命令帧，发送响应帧，配合差错回复

组合站：都有

支持全双工和半双工

平衡的：两个组合站；不平衡的：1主+n从

point to point protocol

<img src="03-Data Link.assets/image-20241213084821189.png" alt="image-20241213084821189" style="zoom:50%;" />